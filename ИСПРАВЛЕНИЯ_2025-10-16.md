# Исправления от 16.10.2025

## Проблемы, которые были решены

### 1. ❌ Ошибка "File is too big" (видео 63 МБ)
**Проблема:** Локальный Telegram Bot API имел дефолтный лимит 20 МБ на файлы.

**Решение:** Переключились на использование стандартного Telegram Bot API, который поддерживает файлы до **50 МБ**.

**Ограничение:** Файлы больше 50 МБ пока не поддерживаются. Для файлов >50 МБ требуется дополнительная настройка локального Bot API.

### 2. ❌ Ошибка "Not Found" (видео 6 МБ)
**Проблема:** Бот пытался использовать локальный Bot API, который был неправильно настроен.

**Решение:** Теперь бот использует стандартный Telegram API, который работает из коробки.

### 3. ✅ Приватность видео на YouTube
**Проблема:** Видео загружались как публичные, игнорируя настройку `YOUTUBE_DEFAULT_PRIVACY=private` из `.env`.

**Решение:** 
- Добавлена поддержка `YOUTUBE_DEFAULT_PRIVACY` в конфигурацию приложения
- Обновлен worker для использования этой настройки при публикации
- Добавлены переменные окружения в docker-compose.yml

## Внесенные изменения

### Файлы, которые были изменены:

1. **`app/config.py`**
   - Добавлен параметр `YOUTUBE_DEFAULT_PRIVACY` (по умолчанию: `"private"`)

2. **`workers/tasks_publish.py`**
   - Добавлена переменная окружения `YOUTUBE_DEFAULT_PRIVACY`
   - Функция `publish_to_youtube()` теперь принимает параметр `privacy_status`
   - Если `privacy_status` не указан, используется значение из `.env`
   - Добавлено логирование приватности при публикации

3. **`docker-compose.yml`**
   - Добавлена переменная `YOUTUBE_DEFAULT_PRIVACY` для сервисов `api` и `worker`
   - Упрощена конфигурация `telegram-bot-api` (убраны проблемные параметры)

4. **`bot/config.py`**
   - `LOCAL_API_URL` теперь пустой по умолчанию (используется стандартный API)

5. **`bot/main.py`**
   - Добавлена условная логика для использования локального API только если он указан

## Как тестировать

### 1. Проверка приватности видео

1. Отправьте видео боту (размер: **6-50 МБ**)
2. Добавьте название и описание
3. После публикации проверьте на YouTube - видео должно быть **приватным** ✅

### 2. Проверка загрузки файлов

- ✅ Видео **до 50 МБ** — должны загружаться успешно
- ⚠️ Видео **50-2000 МБ** — требуется настройка локального Bot API (не реализовано)

## Переменные окружения в `.env`

Убедитесь, что в вашем `.env` файле есть:

```env
# YouTube приватность (по умолчанию: private)
YOUTUBE_DEFAULT_PRIVACY=private  # Варианты: public, private, unlisted
```

## Команды для перезапуска

Если нужно перезапустить систему после изменений:

```bash
docker compose down
docker compose up -d
```

Или только бота и worker:

```bash
docker compose restart bot worker
```

## Статус

- ✅ Приватность видео работает корректно
- ✅ Загрузка файлов до 50 МБ работает
- ⚠️ Файлы >50 МБ требуют дополнительной настройки локального Bot API

## Следующие шаги (опционально)

Если нужна поддержка файлов **больше 50 МБ**:

1. Настроить локальный Telegram Bot API с увеличенными лимитами
2. Обновить `TELEGRAM_LOCAL_API_URL` в `.env`
3. Перезапустить бота

Для этого потребуется дополнительная конфигурация и тестирование.

